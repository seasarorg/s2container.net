<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- don't edit start -->
<head><title>Seasar - DI Container with AOP - </title><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<link href="seasar_b.css" type="text/css" rel="stylesheet" media="screen"><script src="seasar_b.js" type="text/JavaScript" language="JavaScript"></script>
</head><body onload="preload('en')">
<table width="100%" border="0" cellspacing="0" cellpadding="0" align="left"><tr>
<td align="left" valign="top" width="780"><table width="780" border="0" cellspacing="0" cellpadding="0" class="white">
<tr><td colspan="7"><img height="5" width="780" src="images/top01_b.gif" alt=""></td></tr>
<tr><td><img height="117" width="235" src="images/top02_b.gif" alt="Seasar"></td>
<td colspan="3"><img height="117" width="289" src="images/top03.gif" alt="DI Container with AOP"></td>
<td colspan="3"><img height="117" width="256" src="images/spacer.gif" alt=""></td>
</tr><tr><td rowspan="2"><img src="images/top04.gif" alt="" height="49" width="235"></td>
<td><a href="http://www.seasar.org/en/index.html"><img src="images/menu01_b_en.gif" height="30" width="78" border="0" alt="" id="menu01" onmouseover="swap(1)" onmouseout="restore(1)"></a></td>
<td><a href="http://www.seasar.org/en/projects.html"><img src="images/menu02_b_en.gif" height="30" width="101" border="0" alt="" id="menu02" onmouseover="swap(2)" onmouseout="restore(2)"></a></td>
<td><a href="http://www.seasar.org/en/products.html"><img src="images/menu06_b_en.gif" height="30" width="110" border="0" alt="" id="menu06" onmouseover="swap(6)" onmouseout="restore(6)"></a></td>
<td><a href="http://www.seasar.org/en/documents.html"><img src="images/menu04_b_en.gif" height="30" width="109" border="0" alt="" id="menu04" onmouseover="swap(4)" onmouseout="restore(4)"></a></td>
<td><a href="http://www.seasar.org/en/resources.html"><img src="images/menu05_b_en.gif" height="30" width="113" border="0" alt="" id="menu05" onmouseover="swap(5)" onmouseout="restore(5)"></a></td>
<!--
<td><img src="images/menu07_b_en.gif" height="30" width="109" border="0" alt=""  id="menu07" onmouseover="swap(7)" onmouseout="restore(7)"></td>
//-->
<td><img height="30" width="34" src="images/menu06.gif" alt=""></td></tr><tr>

<td colspan="6"><img height="19" width="545" src="images/spacer.gif" alt=""></td></tr></table>
<table  width="780" border="0" cellspacing="0" cellpadding="0" class="menu">
<tr align="left" valign="top"><td width="14"><img height="14" width="14" src="images/spacer.gif" alt=""></td><td width="740" class="main">
<!-- don't edit end --><!-- document start -->

<a href="index.html">S2Container.NET TOP page</a>

<ul>
<li><a href="#Tx">Transaction Control</a></li>
<ul>
<li><a href="#TransAttribute">Transaction Attribute</a></li>
<li><a href="#LocalTx">Local Transaction</a></li>
<li><a href="#DTCTx">Using Microsoft Distributed Transaction Coordinator (MS DTC)</a></li>
<li><a href="#System.Transactions">System.Transactions</a></li>

</ul>
<li><a href="#Exception">Exceptions</a>

</ul>
<h2><a name="Tx">Transaction Contro</a></h2>
<p>Using S2Tx.NET, it is possible to apply an <a href="aop.html">Aspect</a> to manage transaction to a .NET object. Refer to <a href="aop.html#Warning">Warnings</a> before applying an aspect. S2Container.NET supports System.Transactions (.NET 2.0 or higher), local transaction, and MS DTC (Microsoft Distributed Transaction Coordinator). Following are transaction attributes available:</p>

<h3><a name="TransAttribute">Transaction Attributes</a></h3>

<p>Following <a href="aop.html#Advice">Advice</a> are defined in Tx.dicon (System.Transactions), LocalTx.dicon (local transaction), DTCTx.dicon (MS DTC).

<p>
Tx.dicon, LocalTx.dicon, and DTCTx.dicon are available in s2container.net/source/Seasar folder.
</p>
<table border="1">
<tr bgcolor="#d1f3f4" align="center">
<th width="92">Attribute</th>
<th width="170">Component Name</th>
<th width="467">Description</th></tr>

<tr>
	<td rowspan="3">Required</td>
	<td>
		<code>LocalTx.RequiredTx</code>
		<br />(local transaction)
	</td>
	<td rowspan="3" style="vertical-align:top;">
		Share if there is a transaction, and create a new transaction when necessary.
	</td>
</tr>
<tr>
	<td>
		<code>DTCTx.RequiredTx</code>
		<br />(MS DTC)
	</td>
</tr>
<tr>
	<td>
		<code>Tx.RequiredTx</code>
		<br />(System.Transactions)
	</td>
</tr>

<tr>
	<td rowspan="3">RequiresNew</td>
	<td>
		<code>LocalTx.RequiresNewTx</code>
		<br />(local transaction)
	</td>
	<td rowspan="3" style="vertical-align:top;">
		Make new transaction create components independent of the current status of the context.
	</td>
</tr>
<tr>
	<td>
		<code>DTCTx.RequiresNewTx</code>
		<br />(MS DTC)
	</td>
</tr>
<tr>
	<td>
		<code>Tx.RequiresNewTx</code>
		<br />(System.Transactions)
	</td>
</tr>

<tr>
	<td rowspan="2">Supported</td>
	<td>
		<code>LocalTx.SupportedTx</code>
		<br />(local transaction)
	</td>
	<td rowspan="2" style="vertical-align:top;">
		Share when transaction exists.
	</td>
</tr>
<tr>
	<td>
		<code>DTCTx.SupportedTx</code>
		<br />(MS DTC)
	</td>
</tr>

<tr>
	<td rowspan="3">NotSupported</td>
	<td>
		<code>Tx.NotSupportedTx</code>
		<br />(local transaction)
	</td>
	<td rowspan="3" style="vertical-align:top;">
		Make context, which does not have transaction control, create component.
	</td>
</tr>
<tr>
	<td>
		<code>DTCTx.NotSupportedTx</code>
		<br />(MS DTC)
	</td>
</tr>
<tr>
	<td>
		<code>Tx.NotSupportedTx</code>
		<br />(System.Transactions)
	</td>
</tr>
</table>

<h3><a name="LocalTx">Local Transaction</a></h3>
<p>
To use local transaction, retrieve a connection from Seasar.Extension.Tx.Impl.TxDataSource. DAO (Data Access Object) is not used because <a href="aop.html#Advice">Advice(MethodInterceptor)</a> manages opening and closing connections.
Property of type Seasar.Extension.ADO.IDataSource is used to inject TxDataSource into DAO.
</p>
<p>Connection, transaction, command, parameter are created from dataSource. Following is an example of DAO interface and DAO implementation class.
</p>
<h4>EmployeeDao.cs</h4>
C#
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">using</span> System;
<span class="kwrd">using</span> System.Data;
<span class="kwrd">using</span> Seasar.Extension.ADO;

<span class="kwrd">namespace</span> Seasar.Examples.Reference.LocalTx
{
    <span class="rem">// DAO interface to use EMP</span>
    <span class="kwrd">public</span> <span class="kwrd">interface</span> IEmployeeDao
    {
        <span class="kwrd">void</span> Insert();
    }

    <span class="rem">// DAO implementation class to use EMP</span>
    <span class="kwrd">public</span> <span class="kwrd">class</span> EmployeeDaoImpl : IEmployeeDao
    {
        <span class="kwrd">private</span> IDataSource dataSource;

        <span class="rem">// property to inject TxDataSource</span>
        <span class="kwrd">public</span> IDataSource DataSource
        {
            set { dataSource = <span class="kwrd">value</span>; }
        }

        <span class="preproc">#region</span> IEmployeeDao member

        <span class="kwrd">public</span> <span class="kwrd">void</span> Insert()
        {
            <span class="kwrd">string</span> sql = <span class="str">"insert into emp2 values(@empno, @ename, @deptnum)"</span>;
            
            <span class="kwrd">using</span>(IDbCommand cmd = dataSource.GetCommand(sql,
                      dataSource.GetConnection(), dataSource.GetTransaction()))
            {
                cmd.Parameters.Add(dataSource.GetParameter(<span class="str">"@empno"</span>, 99));
                cmd.Parameters.Add(dataSource.GetParameter(<span class="str">"@ename"</span>, <span class="str">"Sugimoto"</span>));
                cmd.Parameters.Add(dataSource.GetParameter(<span class="str">"@deptnum"</span>, 31));
                cmd.ExecuteNonQuery();
                Console.WriteLine(<span class="str">"Inserted employee"</span>);
            }
        }

        <span class="preproc">#endregion</span>
    }
}</pre>
VB.NET
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode vb">
<span class="kwrd">Imports</span> System
<span class="kwrd">Imports</span> System.Data
<span class="kwrd">Imports</span> Seasar.Extension.ADO

<span class="kwrd">Namespace</span> Seasar.Examples.Reference.LocalTx

   <span class="rem">' DAO interface to use EMP</span>
   <span class="kwrd">Public</span> <span class="kwrd">Interface</span> IEmployeeDao
      <span class="kwrd">Sub</span> Insert()
   <span class="kwrd">End</span> <span class="kwrd">Interface</span> <span class="rem">'IEmployeeDao</span>
   
   <span class="rem">' DAO implementation class to use EMP</span>
   <span class="kwrd">Public</span> <span class="kwrd">Class</span> EmployeeDaoImpl
      <span class="kwrd">Implements</span> IEmployeeDao
      
      <span class="kwrd">Private</span> dataSource <span class="kwrd">As</span> IDataSource
      
      <span class="rem">' property to inject TxDataSource</span>
      <span class="kwrd">Public</span> <span class="kwrd">WriteOnly</span> <span class="kwrd">Property</span> DataSource() <span class="kwrd">As</span> IDataSource
         <span class="kwrd">Set</span>(<span class="kwrd">ByVal</span> value <span class="kwrd">As</span> IDataSource)
            dataSource = value
         <span class="kwrd">End</span> <span class="kwrd">Set</span>
      <span class="kwrd">End</span> <span class="kwrd">Property</span>
       
      <span class="kwrd">Public</span> <span class="kwrd">Sub</span> Insert()

         <span class="kwrd">Dim</span> sql <span class="kwrd">As</span> <span class="kwrd">String</span> = <span class="str">"insert into emp2 values(@empno, @ename, @deptnum)"</span>
         
         <span class="kwrd">Dim</span> cmd <span class="kwrd">As</span> IDbCommand = dataSource.GetCommand(sql, _
            dataSource.GetConnection(), dataSource.GetTransaction())
         <span class="kwrd">Try</span>
            cmd.Parameters.Add(dataSource.GetParameter(<span class="str">"@empno"</span>, 99))
            cmd.Parameters.Add(dataSource.GetParameter(<span class="str">"@ename"</span>, <span class="str">"Sugimoto"</span>))
            cmd.Parameters.Add(dataSource.GetParameter(<span class="str">"@deptnum"</span>, 31))
            cmd.ExecuteNonQuery()
            Console.WriteLine(<span class="str">"Inserted employee"</span>)
         <span class="kwrd">Finally</span>
            cmd.Dispose()
         <span class="kwrd">End</span> <span class="kwrd">Try</span>
      <span class="kwrd">End</span> <span class="kwrd">Sub</span>
   <span class="kwrd">End</span> <span class="kwrd">Class</span>
<span class="kwrd">End</span> <span class="kwrd">Namespace</span>
</pre>

<p>Class to executeIEmployeeDao</p>

<h4>LocalTxClient.cs</h4>
C#
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">using</span> System;
<span class="kwrd">using</span> Seasar.Framework.Container;
<span class="kwrd">using</span> Seasar.Framework.Container.Factory;

<span class="kwrd">namespace</span> Seasar.Examples.Reference.LocalTx
{
    <span class="kwrd">public</span> <span class="kwrd">class</span> LocalTxClient
    {
        <span class="kwrd">private</span> <span class="kwrd">static</span> <span class="kwrd">readonly</span> String PATH 
                = <span class="str">"Seasar.Examples/Reference/LocalTx/LocalTxClient.dicon"</span>;

        <span class="kwrd">public</span> LocalTxClient() {}

        <span class="kwrd">public</span> <span class="kwrd">void</span> Main()
        {
            <span class="rem">// create S2Container</span>
            IS2Container container = S2ContainerFactory.Create(PATH);
            <span class="rem">// initialize S2Container</span>
            container.Init();
            
            <span class="rem">// retrieve component to implement IEmployeeDao from S2Container</span>
            IEmployeeDao dao = (IEmployeeDao) container.GetComponent(<span class="kwrd">typeof</span>(IEmployeeDao));

            <span class="rem">// insert employee</span>
            dao.Insert();
        }
    }
}</pre>

VB.NET
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode vb">
<span class="kwrd">Imports</span> System
<span class="kwrd">Imports</span> Seasar.Framework.Container
<span class="kwrd">Imports</span> Seasar.Framework.Container.Factory

<span class="kwrd">Namespace</span> Seasar.Examples.Reference.LocalTx

   <span class="kwrd">Public</span> <span class="kwrd">Class</span> LocalTxClient

      <span class="kwrd">Private</span> <span class="kwrd">Shared</span> PATH <span class="kwrd">As</span> [<span class="kwrd">String</span>] = _
         <span class="str">"Seasar.Examples/Reference/LocalTx/LocalTxClient.dicon"</span>
      
      <span class="kwrd">Public</span> <span class="kwrd">Sub</span> <span class="kwrd">New</span>()
      <span class="kwrd">End</span> <span class="kwrd">Sub</span>
       
      <span class="kwrd">Public</span> <span class="kwrd">Sub</span> Main()

         <span class="rem">' create S2Container</span>
         <span class="kwrd">Dim</span> container <span class="kwrd">As</span> IS2Container = S2ContainerFactory.Create(PATH)
         <span class="rem">' initialized S2Container</span>
         container.Init()
         
         <span class="rem">' retrieve component to implement IEmployeeDao from S2Container</span>
         <span class="kwrd">Dim</span> dao <span class="kwrd">As</span> IEmployeeDao = _
            <span class="kwrd">CType</span>(container.GetComponent(<span class="kwrd">GetType</span>(IEmployeeDao)), IEmployeeDao)
         
         <span class="rem">' insert employee</span>
         dao.Insert()
      <span class="kwrd">End</span> <span class="kwrd">Sub</span>
   <span class="kwrd">End</span> <span class="kwrd">Class</span>
<span class="kwrd">End</span> <span class="kwrd">Namespace</span>
</pre>

<p>Following is an example of a dicon file. To apply Required attribute transaction, aspect in EmployeeDaoImpl is set to LocalTx.Required.</p>
<h4>LocalTxClient.dicon</h4>
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">&lt;?</span><span class="html">xml</span> <span class="attr">version</span><span class="kwrd">="1.0"</span> <span class="attr">encoding</span><span class="kwrd">="utf-8"</span> ?<span class="kwrd">&gt;</span>
<span class="kwrd">&lt;!</span><span class="html">DOCTYPE</span> <span class="attr">components</span> <span class="attr">PUBLIC</span> <span class="kwrd">"-//SEASAR2.1//DTD S2Container//EN"</span>
<span class="kwrd">"http://www.seasar.org/dtd/components21.dtd"</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">components</span><span class="kwrd">&gt;</span>
    
    <span class="kwrd">&lt;</span><span class="html">include</span> <span class="attr">path</span><span class="kwrd">="Seasar.Examples/Tx.dicon"</span> <span class="kwrd">/&gt;</span>
    
    <span class="kwrd">&lt;</span><span class="html">component</span> <span class="attr">name</span><span class="kwrd">="LocalTxClient"</span> <span class="attr">class</span><span class="kwrd">="Seasar.Examples.Reference.LocalTx.LocalTxClient"</span> <span class="kwrd">/&gt;</span>
    
    <span class="kwrd">&lt;</span><span class="html">component</span> <span class="attr">class</span><span class="kwrd">="Seasar.Examples.Reference.LocalTx.EmployeeDaoImpl"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">aspect</span><span class="kwrd">&gt;</span>LocalTx.RequiredTx<span class="kwrd">&lt;/</span><span class="html">aspect</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">component</span><span class="kwrd">&gt;</span>
    
<span class="kwrd">&lt;/</span><span class="html">components</span><span class="kwrd">&gt;</span>
</pre>

<h4>Tx.dicon</h4>
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">&lt;?</span><span class="html">xml</span> <span class="attr">version</span><span class="kwrd">="1.0"</span> <span class="attr">encoding</span><span class="kwrd">="utf-8"</span> ?<span class="kwrd">&gt;</span>
<span class="kwrd">&lt;!</span><span class="html">DOCTYPE</span> <span class="attr">components</span> <span class="attr">PUBLIC</span> <span class="kwrd">"-//SEASAR2.1//DTD S2Container//EN"</span>
<span class="kwrd">"http://www.seasar.org/dtd/components21.dtd"</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">components</span> <span class="attr">namespace</span><span class="kwrd">="LocalTx"</span><span class="kwrd">&gt;</span>
    
    <span class="kwrd">&lt;</span><span class="html">include</span> <span class="attr">path</span><span class="kwrd">="Seasar.Examples/Ado.dicon"</span> <span class="kwrd">/&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">component</span> <span class="attr">name</span><span class="kwrd">="SqlDataSource"</span> <span class="attr">class</span><span class="kwrd">="Seasar.Extension.Tx.Impl.TxDataSource"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">property</span> <span class="attr">name</span><span class="kwrd">="DataProvider"</span><span class="kwrd">&gt;</span>Ado.SqlClient<span class="kwrd">&lt;/</span><span class="html">property</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">property</span> <span class="attr">name</span><span class="kwrd">="ConnectionString"</span><span class="kwrd">&gt;</span>
            "Server=SQL ServerÇÃñºèÃ;database=s2dotnetdemo;Integrated Security=SSPI"
        <span class="kwrd">&lt;/</span><span class="html">property</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">component</span><span class="kwrd">&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">component</span> <span class="attr">class</span><span class="kwrd">="Seasar.Extension.Tx.Impl.TransactionContext"</span> <span class="kwrd">/&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">component</span> <span class="attr">name</span><span class="kwrd">="RequiredTx"</span> <span class="attr">class</span><span class="kwrd">="Seasar.Extension.Tx.TransactionInterceptor"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">arg</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">component</span> <span class="attr">class</span><span class="kwrd">="Seasar.Extension.Tx.Impl.LocalRequiredTxHandler"</span> <span class="kwrd">/&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">arg</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">component</span><span class="kwrd">&gt;</span>
    
    ...

<span class="kwrd">&lt;/</span><span class="html">components</span><span class="kwrd">&gt;</span>
</pre>

<h4>Ado.dicon</h4>
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">&lt;?</span><span class="html">xml</span> <span class="attr">version</span><span class="kwrd">="1.0"</span> <span class="attr">encoding</span><span class="kwrd">="utf-8"</span> ?<span class="kwrd">&gt;</span>
<span class="kwrd">&lt;!</span><span class="html">DOCTYPE</span> <span class="attr">components</span> <span class="attr">PUBLIC</span> <span class="kwrd">"-//SEASAR2.1//DTD S2Container//EN"</span>
<span class="kwrd">"http://www.seasar.org/dtd/components21.dtd"</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">components</span> <span class="attr">namespace</span><span class="kwrd">="Ado"</span><span class="kwrd">&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">component</span> <span class="attr">name</span><span class="kwrd">="SqlClient"</span> <span class="attr">class</span><span class="kwrd">="Seasar.Extension.ADO.DataProvider"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">property</span> <span class="attr">name</span><span class="kwrd">="ConnectionType"</span><span class="kwrd">&gt;</span>"System.Data.SqlClient.SqlConnection"<span class="kwrd">&lt;/</span><span class="html">property</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">property</span> <span class="attr">name</span><span class="kwrd">="CommandType"</span><span class="kwrd">&gt;</span>"System.Data.SqlClient.SqlCommand"<span class="kwrd">&lt;/</span><span class="html">property</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">property</span> <span class="attr">name</span><span class="kwrd">="ParameterType"</span><span class="kwrd">&gt;</span>"System.Data.SqlClient.SqlParameter"<span class="kwrd">&lt;/</span><span class="html">property</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">property</span> <span class="attr">name</span><span class="kwrd">="DataAdapterType"</span><span class="kwrd">&gt;</span>"System.Data.SqlClient.SqlDataAdapter"<span class="kwrd">&lt;/</span><span class="html">property</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">component</span><span class="kwrd">&gt;</span>
    
<span class="kwrd">&lt;/</span><span class="html">components</span><span class="kwrd">&gt;</span>
</pre>

<h4>Result:</h4>
<pre>
DEBUG transaction began
EMP inserted
DEBUG transaction committed
</pre>

<h3><a name="DTCTx">Using Microsoft Distributed Transaction Coordinator (MS DTC) </a></h3>

<p>MS DTC must be properly setup before using MS DTC. When MS DTC is used, connection do not have to be retrieved from TxDataSource, but to write source code that is not dependent on a data provider, connection, command, and parameter objects are created from Seasar.Extension.ADO.Impl.DataSourceImpl.
</p>
<p>
When MS DTC is used, a transaction is maintained even if a connection is closed after each query.
</p>
<p>
Following is an example of DAO interface and DAO implementation class.
</p>

<h4>EmployeeDao.cs</h4>
C#
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">using</span> System;
<span class="kwrd">using</span> System.Data;
<span class="kwrd">using</span> Seasar.Extension.ADO;

<span class="kwrd">namespace</span> Seasar.Examples.Reference.DTCTx
{
    <span class="rem">// DAO interface to use EMP</span>
    <span class="kwrd">public</span> <span class="kwrd">interface</span> IEmployeeDao
    {
        <span class="kwrd">void</span> Insert();
    }

    <span class="rem">// DAO implementation class to use EMP</span>
    <span class="kwrd">public</span> <span class="kwrd">class</span> EmployeeDaoImpl : IEmployeeDao
    {
        <span class="kwrd">private</span> IDataSource dataSource;

        <span class="rem">// property to inject DataSourceImpl</span>
        <span class="kwrd">public</span> IDataSource DataSource
        {
            set { dataSource = <span class="kwrd">value</span>; }
        }

        <span class="preproc">#region</span> IEmployeeDao member

        <span class="kwrd">public</span> <span class="kwrd">void</span> Insert()
        {
            <span class="kwrd">using</span>(IDbConnection cn = dataSource.GetConnection())
            {
                cn.Open();
                <span class="kwrd">string</span> sql = <span class="str">"insert into emp2 values(@empno, @ename, @deptnum)"</span>;
                <span class="kwrd">using</span>(IDbCommand cmd = dataSource.GetCommand(sql,cn))
                {
                    cmd.Parameters.Add(dataSource.GetParameter(<span class="str">"@empno"</span>, 99));
                    cmd.Parameters.Add(dataSource.GetParameter(<span class="str">"@ename"</span>, <span class="str">"Sugimoto"</span>));
                    cmd.Parameters.Add(dataSource.GetParameter(<span class="str">"@deptnum"</span>, 31));
                    cmd.ExecuteNonQuery();
                    Console.WriteLine(<span class="str">"inserted employee"</span>);
                }
            }
        }

        <span class="preproc">#endregion</span>
    }
}
</pre>

VB.NET
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode vb">
<span class="kwrd">Imports</span> System
<span class="kwrd">Imports</span> System.Data
<span class="kwrd">Imports</span> Seasar.Extension.ADO

<span class="kwrd">Namespace</span> Seasar.Examples.Reference.DTCTx

   <span class="rem">' DAO interface to use EMP</span>
   <span class="kwrd">Public</span> <span class="kwrd">Interface</span> IEmployeeDao
      <span class="kwrd">Sub</span> Insert()
   <span class="kwrd">End</span> <span class="kwrd">Interface</span>
   
   <span class="rem">' DAO implementation class to use EMP</span>
   <span class="kwrd">Public</span> <span class="kwrd">Class</span> EmployeeDaoImpl
      <span class="kwrd">Implements</span> IEmployeeDao

      <span class="kwrd">Private</span> dataSource <span class="kwrd">As</span> IDataSource
      
      <span class="rem">' property to inject DataSourceImpl</span>
      <span class="kwrd">Public</span> <span class="kwrd">WriteOnly</span> <span class="kwrd">Property</span> DataSource() <span class="kwrd">As</span> IDataSource
         <span class="kwrd">Set</span>(<span class="kwrd">ByVal</span> value <span class="kwrd">As</span> IDataSource)
            dataSource = value
         <span class="kwrd">End</span> <span class="kwrd">Set</span>
      <span class="kwrd">End</span> <span class="kwrd">Property</span>
       
      <span class="kwrd">Public</span> <span class="kwrd">Sub</span> Insert()

         <span class="kwrd">Dim</span> cn <span class="kwrd">As</span> IDbConnection = dataSource.GetConnection()
         <span class="kwrd">Try</span>
            cn.Open()
            <span class="kwrd">Dim</span> sql <span class="kwrd">As</span> <span class="kwrd">String</span> = <span class="str">"insert into emp2 values(@empno, @ename, @deptnum)"</span>
            <span class="kwrd">Dim</span> cmd <span class="kwrd">As</span> IDbCommand = dataSource.GetCommand(sql, cn)
            <span class="kwrd">Try</span>
               cmd.Parameters.Add(dataSource.GetParameter(<span class="str">"@empno"</span>, 99))
               cmd.Parameters.Add(dataSource.GetParameter(<span class="str">"@ename"</span>, <span class="str">"Sugimoto"</span>))
               cmd.Parameters.Add(dataSource.GetParameter(<span class="str">"@deptnum"</span>, 31))
               cmd.ExecuteNonQuery()
               Console.WriteLine(<span class="str">"inserted employee"</span>)
            <span class="kwrd">Finally</span>
               cmd.Dispose()
            <span class="kwrd">End</span> <span class="kwrd">Try</span>
         <span class="kwrd">Finally</span>
            cn.Dispose()
         <span class="kwrd">End</span> <span class="kwrd">Try</span>

      <span class="kwrd">End</span> <span class="kwrd">Sub</span>

   <span class="kwrd">End</span> <span class="kwrd">Class</span>

<span class="kwrd">End</span> <span class="kwrd">Namespace</span>
</pre>

<p>Class to execute IEmployeeDao is as follows:</p>
<h4>DTCTxClient.cs</h4>
C#
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">using</span> System;
<span class="kwrd">using</span> Seasar.Framework.Container;
<span class="kwrd">using</span> Seasar.Framework.Container.Factory;

<span class="kwrd">namespace</span> Seasar.Examples.Reference.DTCTx
{
    <span class="kwrd">public</span> <span class="kwrd">class</span> DTCTxClient
    {
        <span class="kwrd">private</span> <span class="kwrd">static</span> <span class="kwrd">readonly</span> String PATH 
                = <span class="str">"Seasar.Examples/Reference/DTCTx/DTCTxClient.dicon"</span>;

        <span class="kwrd">public</span> DTCTxClient() {}

        <span class="kwrd">public</span> <span class="kwrd">void</span> Main()
        {
            <span class="rem">// create S2Container</span>
            IS2Container container = S2ContainerFactory.Create(PATH);
            <span class="rem">// initialize S2Container</span>
            container.Init();
            
            <span class="rem">// retrieve component to implement IEmployeeDao from S2Container</span>
            IEmployeeDao dao = (IEmployeeDao) container.GetComponent(<span class="kwrd">typeof</span>(IEmployeeDao));

            <span class="rem">// inserted employee</span>
            dao.Insert();
        }
    }
}
</pre>

VB.NET
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode vb">
<span class="kwrd">Imports</span> System
<span class="kwrd">Imports</span> Seasar.Framework.Container
<span class="kwrd">Imports</span> Seasar.Framework.Container.Factory

<span class="kwrd">Namespace</span> Seasar.Examples.Reference.DTCTx

   <span class="kwrd">Public</span> <span class="kwrd">Class</span> DTCTxClient
      <span class="kwrd">Private</span> <span class="kwrd">Shared</span> PATH <span class="kwrd">As</span> [<span class="kwrd">String</span>] = _
         <span class="str">"Seasar.Examples/Reference/DTCTx/DTCTxClient.dicon"</span>
      
      <span class="kwrd">Public</span> <span class="kwrd">Sub</span> <span class="kwrd">New</span>()
      <span class="kwrd">End</span> <span class="kwrd">Sub</span>
       
      <span class="kwrd">Public</span> <span class="kwrd">Sub</span> Main()

         <span class="rem">' create S2Container</span>
         <span class="kwrd">Dim</span> container <span class="kwrd">As</span> IS2Container = S2ContainerFactory.Create(PATH)
         <span class="rem">' initialize S2Container</span>
         container.Init()
         
         <span class="rem">' retrieve component to implement IEmployeeDao from S2Container</span>
         <span class="kwrd">Dim</span> dao <span class="kwrd">As</span> IEmployeeDao = _
            <span class="kwrd">CType</span>(container.GetComponent(<span class="kwrd">GetType</span>(IEmployeeDao)), IEmployeeDao)
         
         <span class="rem">' insert employee</span>
         dao.Insert()

      <span class="kwrd">End</span> <span class="kwrd">Sub</span>

   <span class="kwrd">End</span> <span class="kwrd">Class</span>

<span class="kwrd">End</span> <span class="kwrd">Namespace</span>
</pre>

<p>Following is an example of a dicon file.  To apply Required attribute transaction, aspect in EmployeeDaoImpl is set to DTCTx.RequiredTx.
</p>
<h4>DTCTxClient.dicon</h4>
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">&lt;?</span><span class="html">xml</span> <span class="attr">version</span><span class="kwrd">="1.0"</span> <span class="attr">encoding</span><span class="kwrd">="utf-8"</span> ?<span class="kwrd">&gt;</span> 
<span class="kwrd">&lt;!</span><span class="html">DOCTYPE</span> <span class="attr">components</span> <span class="attr">PUBLIC</span> <span class="kwrd">"-//SEASAR2.1//DTD S2Container//EN"</span>
<span class="kwrd">"http://www.seasar.org/dtd/components21.dtd"</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">components</span><span class="kwrd">&gt;</span>
    
    <span class="kwrd">&lt;</span><span class="html">include</span> <span class="attr">path</span><span class="kwrd">="Seasar.Examples/DTCTx.dicon"</span> <span class="kwrd">/&gt;</span>
    
    <span class="kwrd">&lt;</span><span class="html">component</span> <span class="attr">name</span><span class="kwrd">="DTCTxClient"</span> <span class="attr">class</span><span class="kwrd">="Seasar.Examples.Reference.DTCTx.DTCTxClient"</span> <span class="kwrd">/&gt;</span>
    
    <span class="kwrd">&lt;</span><span class="html">component</span> <span class="attr">class</span><span class="kwrd">="Seasar.Examples.Reference.DTCTx.EmployeeDaoImpl"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">aspect</span><span class="kwrd">&gt;</span>DTCTx.RequiredTx<span class="kwrd">&lt;/</span><span class="html">aspect</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">component</span><span class="kwrd">&gt;</span>
    
<span class="kwrd">&lt;/</span><span class="html">components</span><span class="kwrd">&gt;</span>
</pre>

<h4>DTCTx.dicon</h4>
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">&lt;?</span><span class="html">xml</span> <span class="attr">version</span><span class="kwrd">="1.0"</span> <span class="attr">encoding</span><span class="kwrd">="utf-8"</span> ?<span class="kwrd">&gt;</span> 
<span class="kwrd">&lt;!</span><span class="html">DOCTYPE</span> <span class="attr">components</span> <span class="attr">PUBLIC</span> <span class="kwrd">"-//SEASAR2.1//DTD S2Container//EN"</span>
<span class="kwrd">"http://www.seasar.org/dtd/components21.dtd"</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">components</span> <span class="attr">namespace</span><span class="kwrd">="DTCTx"</span><span class="kwrd">&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">include</span> <span class="attr">path</span><span class="kwrd">="Seasar.Examples/Ado.dicon"</span> <span class="kwrd">/&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">component</span> <span class="attr">name</span><span class="kwrd">="SqlDataSource"</span> <span class="attr">class</span><span class="kwrd">="Seasar.Extension.ADO.Impl.DataSourceImpl"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">property</span> <span class="attr">name</span><span class="kwrd">="DataProvider"</span><span class="kwrd">&gt;</span>Ado.SqlClient<span class="kwrd">&lt;/</span><span class="html">property</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">property</span> <span class="attr">name</span><span class="kwrd">="ConnectionString"</span><span class="kwrd">&gt;</span>
            "Server=SQL ServerÇÃñºèÃ;database=s2dotnetdemo;Integrated Security=SSPI"
        <span class="kwrd">&lt;/</span><span class="html">property</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">component</span><span class="kwrd">&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">component</span> <span class="attr">name</span><span class="kwrd">="DTCTransactionStateHandler"</span> 
            <span class="attr">class</span><span class="kwrd">="Seasar.Extension.Tx.Impl.DTCTransactionStateHandler"</span> <span class="kwrd">/&gt;</span>
            
    <span class="kwrd">&lt;</span><span class="html">component</span> <span class="attr">name</span><span class="kwrd">="RequiredTx"</span> <span class="attr">class</span><span class="kwrd">="Seasar.Extension.Tx.TransactionInterceptor"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">arg</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">component</span> <span class="attr">class</span><span class="kwrd">="Seasar.Extension.Tx.Impl.DTCRequiredTxHandler"</span> <span class="kwrd">/&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">arg</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">component</span><span class="kwrd">&gt;</span>

    ...
    
<span class="kwrd">&lt;/</span><span class="html">components</span><span class="kwrd">&gt;</span>
</pre>
<p>
Ado.dicon and result is the same as those of local transaction.
</p>

<h3><a name="System.Transactions">System.Transactions</a></h3>

<p>Unlike in local transaction, connection do not have to be retrieved from TxDataSource, but to write source code that is not dependent on a data provider, connection, command, and parameter objects are created from Seasar.Extension.ADO.Impl.DataSourceImpl. 
</p>
<p>
When System.Transactions is used, a transaction is maintained even if a connection is closed after each query. 
</p>
<p>
Following is an example of DAO interface and DAO implementation class. 
</p>

<h4>EmployeeDao.cs</h4>
C#
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">using</span> System;
<span class="kwrd">using</span> System.Data;
<span class="kwrd">using</span> Seasar.Extension.ADO;

<span class="kwrd">namespace</span> Seasar.Examples.Reference.Tx
{
    <span class="rem">// DAO interface to use EMP</span>
    <span class="kwrd">public</span> <span class="kwrd">interface</span> IEmployeeDao
    {
        <span class="kwrd">void</span> Insert();
    }

    <span class="rem">// DAO implementation class to use EMP</span>
    <span class="kwrd">public</span> <span class="kwrd">class</span> EmployeeDaoImpl : IEmployeeDao
    {
        <span class="kwrd">private</span> IDataSource dataSource;

        <span class="rem">// property to inject DataSourceImpl</span>
        <span class="kwrd">public</span> IDataSource DataSource
        {
            set { dataSource = <span class="kwrd">value</span>; }
        }

        <span class="preproc">#region</span> IEmployeeDao member

        <span class="kwrd">public</span> <span class="kwrd">void</span> Insert()
        {
            <span class="kwrd">using</span>(IDbConnection cn = dataSource.GetConnection())
            {
                cn.Open();
                <span class="kwrd">string</span> sql = <span class="str">"insert into emp2 values(@empno, @ename, @deptnum)"</span>;
                <span class="kwrd">using</span>(IDbCommand cmd = dataSource.GetCommand(sql,cn))
                {
                    cmd.Parameters.Add(dataSource.GetParameter(<span class="str">"@empno"</span>, 99));
                    cmd.Parameters.Add(dataSource.GetParameter(<span class="str">"@ename"</span>, <span class="str">"Sugimoto"</span>));
                    cmd.Parameters.Add(dataSource.GetParameter(<span class="str">"@deptnum"</span>, 31));
                    cmd.ExecuteNonQuery();
                    Console.WriteLine(<span class="str">"inserted employee"</span>);
                }
            }
        }

        <span class="preproc">#endregion</span>
    }
}
</pre>

VB.NET
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode vb">
<span class="kwrd">Imports</span> System
<span class="kwrd">Imports</span> System.Data
<span class="kwrd">Imports</span> Seasar.Extension.ADO

<span class="kwrd">Namespace</span> Seasar.Examples.Reference.Tx

   <span class="rem">' DAO interface to use EMP</span>
   <span class="kwrd">Public</span> <span class="kwrd">Interface</span> IEmployeeDao
      <span class="kwrd">Sub</span> Insert()
   <span class="kwrd">End</span> <span class="kwrd">Interface</span>
   
   <span class="rem">' DAO implementation class to use EMP</span>
   <span class="kwrd">Public</span> <span class="kwrd">Class</span> EmployeeDaoImpl
      <span class="kwrd">Implements</span> IEmployeeDao

      <span class="kwrd">Private</span> dataSource <span class="kwrd">As</span> IDataSource
      
      <span class="rem">' property to inject DataSourceImpl</span>
      <span class="kwrd">Public</span> <span class="kwrd">WriteOnly</span> <span class="kwrd">Property</span> DataSource() <span class="kwrd">As</span> IDataSource
         <span class="kwrd">Set</span>(<span class="kwrd">ByVal</span> value <span class="kwrd">As</span> IDataSource)
            dataSource = value
         <span class="kwrd">End</span> <span class="kwrd">Set</span>
      <span class="kwrd">End</span> <span class="kwrd">Property</span>
       
      <span class="kwrd">Public</span> <span class="kwrd">Sub</span> Insert()

         <span class="kwrd">Dim</span> cn <span class="kwrd">As</span> IDbConnection = dataSource.GetConnection()
         <span class="kwrd">Try</span>
            cn.Open()
            <span class="kwrd">Dim</span> sql <span class="kwrd">As</span> <span class="kwrd">String</span> = <span class="str">"insert into emp2 values(@empno, @ename, @deptnum)"</span>
            <span class="kwrd">Dim</span> cmd <span class="kwrd">As</span> IDbCommand = dataSource.GetCommand(sql, cn)
            <span class="kwrd">Try</span>
               cmd.Parameters.Add(dataSource.GetParameter(<span class="str">"@empno"</span>, 99))
               cmd.Parameters.Add(dataSource.GetParameter(<span class="str">"@ename"</span>, <span class="str">"Sugimoto"</span>))
               cmd.Parameters.Add(dataSource.GetParameter(<span class="str">"@deptnum"</span>, 31))
               cmd.ExecuteNonQuery()
               Console.WriteLine(<span class="str">"inserted employee"</span>)
            <span class="kwrd">Finally</span>
               cmd.Dispose()
            <span class="kwrd">End</span> <span class="kwrd">Try</span>
         <span class="kwrd">Finally</span>
            cn.Dispose()
         <span class="kwrd">End</span> <span class="kwrd">Try</span>

      <span class="kwrd">End</span> <span class="kwrd">Sub</span>

   <span class="kwrd">End</span> <span class="kwrd">Class</span>

<span class="kwrd">End</span> Namespace</pre>

<p>Following is an example of a class to execute IEmployeeDao</p>
<h4>TxClient.cs</h4>
C#
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">using</span> System;
<span class="kwrd">using</span> Seasar.Framework.Container;
<span class="kwrd">using</span> Seasar.Framework.Container.Factory;

<span class="kwrd">namespace</span> Seasar.Examples.Reference.Tx
{
    <span class="kwrd">public</span> <span class="kwrd">class</span> TxClient
    {
        <span class="kwrd">private</span> <span class="kwrd">static</span> <span class="kwrd">readonly</span> String PATH 
                = <span class="str">"Seasar.Examples/Reference/Tx/TxClient.dicon"</span>;

        <span class="kwrd">public</span> TxClient() {}

        <span class="kwrd">public</span> <span class="kwrd">void</span> Main()
        {
            <span class="rem">// create S2Container</span>
            IS2Container container = S2ContainerFactory.Create(PATH);
            <span class="rem">// initialize S2Container</span>
            container.Init();
            
            <span class="rem">// retrieve component to implement IEmployeeDao from S2Container</span>
            IEmployeeDao dao = (IEmployeeDao) container.GetComponent(<span class="kwrd">typeof</span>(IEmployeeDao));

            <span class="rem">// insert employee</span>
            dao.Insert();
        }
    }
}
</pre>

VB.NET
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode vb">
<span class="kwrd">Imports</span> System
<span class="kwrd">Imports</span> Seasar.Framework.Container
<span class="kwrd">Imports</span> Seasar.Framework.Container.Factory

<span class="kwrd">Namespace</span> Seasar.Examples.Reference.Tx

   <span class="kwrd">Public</span> <span class="kwrd">Class</span> TxClient
      <span class="kwrd">Private</span> <span class="kwrd">Shared</span> PATH <span class="kwrd">As</span> [<span class="kwrd">String</span>] = _
         <span class="str">"Seasar.Examples/Reference/Tx/TxClient.dicon"</span>
      
      <span class="kwrd">Public</span> <span class="kwrd">Sub</span> <span class="kwrd">New</span>()
      <span class="kwrd">End</span> <span class="kwrd">Sub</span>
       
      <span class="kwrd">Public</span> <span class="kwrd">Sub</span> Main()

         <span class="rem">' create S2Container</span>
         <span class="kwrd">Dim</span> container <span class="kwrd">As</span> IS2Container = S2ContainerFactory.Create(PATH)
         <span class="rem">' initialize S2Container</span>
         container.Init()
         
         <span class="rem">' retrieve component to implement IEmployeeDao from S2Container</span>
         <span class="kwrd">Dim</span> dao <span class="kwrd">As</span> IEmployeeDao = _
            <span class="kwrd">CType</span>(container.GetComponent(<span class="kwrd">GetType</span>(IEmployeeDao)), IEmployeeDao)
         
         <span class="rem">' insert employee</span>
         dao.Insert()

      <span class="kwrd">End</span> <span class="kwrd">Sub</span>

   <span class="kwrd">End</span> <span class="kwrd">Class</span>

<span class="kwrd">End</span> <span class="kwrd">Namespace</span>
</pre>

<p>
Following is an example of a dicon file. To apply Required attribute transaction, aspect in EmployeeDaoImpl is set to Tx.RequiredTx. 
</p>
<h4>TxClient.dicon</h4>
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">&lt;?</span><span class="html">xml</span> <span class="attr">version</span><span class="kwrd">="1.0"</span> <span class="attr">encoding</span><span class="kwrd">="utf-8"</span> ?<span class="kwrd">&gt;</span> 
<span class="kwrd">&lt;!</span><span class="html">DOCTYPE</span> <span class="attr">components</span> <span class="attr">PUBLIC</span> <span class="kwrd">"-//SEASAR2.1//DTD S2Container//EN"</span>
<span class="kwrd">"http://www.seasar.org/dtd/components21.dtd"</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">components</span><span class="kwrd">&gt;</span>
    
    <span class="kwrd">&lt;</span><span class="html">include</span> <span class="attr">path</span><span class="kwrd">="Seasar.Examples/Tx.dicon"</span> <span class="kwrd">/&gt;</span>
    
    <span class="kwrd">&lt;</span><span class="html">component</span> <span class="attr">name</span><span class="kwrd">="TxClient"</span> <span class="attr">class</span><span class="kwrd">="Seasar.Examples.Reference.Tx.TxClient"</span> <span class="kwrd">/&gt;</span>
    
    <span class="kwrd">&lt;</span><span class="html">component</span> <span class="attr">class</span><span class="kwrd">="Seasar.Examples.Reference.Tx.EmployeeDaoImpl"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">aspect</span><span class="kwrd">&gt;</span>Tx.RequiredTx<span class="kwrd">&lt;/</span><span class="html">aspect</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">component</span><span class="kwrd">&gt;</span>
    
<span class="kwrd">&lt;/</span><span class="html">components</span><span class="kwrd">&gt;</span>
</pre>

<h4>Tx.dicon</h4>
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">&lt;?</span><span class="html">xml</span> <span class="attr">version</span><span class="kwrd">="1.0"</span> <span class="attr">encoding</span><span class="kwrd">="utf-8"</span> ?<span class="kwrd">&gt;</span> 
<span class="kwrd">&lt;!</span><span class="html">DOCTYPE</span> <span class="attr">components</span> <span class="attr">PUBLIC</span> <span class="kwrd">"-//SEASAR2.1//DTD S2Container//EN"</span>
<span class="kwrd">"http://www.seasar.org/dtd/components21.dtd"</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">components</span> <span class="attr">namespace</span><span class="kwrd">="Tx"</span><span class="kwrd">&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">include</span> <span class="attr">path</span><span class="kwrd">="Seasar.Examples/Ado.dicon"</span> <span class="kwrd">/&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">component</span> <span class="attr">name</span><span class="kwrd">="SqlDataSource"</span> <span class="attr">class</span><span class="kwrd">="Seasar.Extension.ADO.Impl.DataSourceImpl"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">property</span> <span class="attr">name</span><span class="kwrd">="DataProvider"</span><span class="kwrd">&gt;</span>Ado.SqlClient<span class="kwrd">&lt;/</span><span class="html">property</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">property</span> <span class="attr">name</span><span class="kwrd">="ConnectionString"</span><span class="kwrd">&gt;</span>
            "Server=SQL Server name;database=s2dotnetdemo;Integrated Security=SSPI"
        <span class="kwrd">&lt;/</span><span class="html">property</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">component</span><span class="kwrd">&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">component</span> <span class="attr">name</span><span class="kwrd">="TransactionStateHandler"</span> 
            <span class="attr">class</span><span class="kwrd">="Seasar.Extension.Tx.Impl.TransactionStateHandler"</span> <span class="kwrd">/&gt;</span>
            
    <span class="kwrd">&lt;</span><span class="html">component</span> <span class="attr">name</span><span class="kwrd">="RequiredTx"</span> <span class="attr">class</span><span class="kwrd">="Seasar.Extension.Tx.TransactionInterceptor"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">arg</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">component</span> <span class="attr">class</span><span class="kwrd">="Seasar.Extension.Tx.Impl.RequiredTxHandler"</span> <span class="kwrd">/&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">arg</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">component</span><span class="kwrd">&gt;</span>

    ...
    
<span class="kwrd">&lt;/</span><span class="html">components</span><span class="kwrd">&gt;</span>
</pre>
<p>
Ado.dicon and execution result are the same as those in local transaction
</p>

<p>S2Container.NET by default provides Tx.dicon, LocalTx.dicon, and DTCTx.dicon (s2container.net/source/Seasar). It is only necessary to set component name of an Advice to an aspect tag.
</p>
<h2><a name="Exception">Exceptions</a></h2>
<p>When a component throws an exception, Advice defined in Tx.dicon and DTCTx.dion will rolled back the transaction.<br>

<!-- document end -->
<!-- don't edit start -->
</td>
          <td width=14><img height=14 alt="" src="images/spacer.gif" 
            width=14></td></tr>
        <tr>
          <td width=14><img height=30 alt="" src="images/spacer.gif" 
            width=14></td>
          <td width=766><img height=30 alt="" src="images/spacer.gif" 
            width=592></td></tr>
        <tr>
          <td width=14><img height=14 alt="" src="images/spacer.gif" 
            width=14></td>
<td class=copyright><table cellSpacing=0 cellPadding=0 width=736><tr><td align="left">Trans. by H.Ozawa</td><td align="right">Copyright&copy; 2004-2006, The Seasar Foundation and the others. All rights reserved.</td></tr></table></td>
</tr></table>
    <td class=backright vAlign=top align=left>&nbsp;</td></tr>
  <tr>
    <td class=backunder vAlign=top align=left width=780 height=16>&nbsp;</td>
    <td class=backcorner vAlign=top align=left 
height=16>&nbsp;</td></tr></tbody></table>
<!-- don't edit end -->
</body></html>